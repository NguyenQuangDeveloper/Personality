<UserControl
    x:Class="VSLibrary.UIComponent.LayoutPanels.CenterPanel.Parameter.VsParameter"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:VSControls="clr-namespace:VSLibrary.UIComponent.VSControls"
    xmlns:converters="clr-namespace:VSLibrary.UIComponent.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:VSLibrary.UIComponent.LayoutPanels.CenterPanel.Parameter"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vsl="clr-namespace:VSLibrary.UIComponent.Localization"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <UserControl.Resources>
        <!--  InverseBooleanConverter 정의  -->
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <converters:Int64ToInt32Converter x:Key="Int64ToInt32Converter" />
        <converters:BooleanConverter x:Key="BooleanConverter" />
        <converters:BooleanToIconConverter x:Key="BooleanToIconConverter" />
        <converters:DoubleToStringConverter x:Key="DoubleToStringConverter" />

        <!--  DataTemplate 정의  -->
        <!--  Number 템플릿  -->
        <DataTemplate x:Key="NumberTemplate">
            <TextBox Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" ToolTip="{Binding ToolTip}" />
        </DataTemplate>

        <!--  ComboBox 템플릿  -->
        <DataTemplate x:Key="ComboBoxTemplate">
            <ComboBox
                IsEnabled="{Binding IsEditable}"
                ItemsSource="{Binding OptionItems}"
                SelectedIndex="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                ToolTip="{Binding ToolTip, FallbackValue='항목을 선택하세요.'}" />
        </DataTemplate>

        <!--  CheckBox 템플릿  -->
        <DataTemplate x:Key="CheckBoxTemplate">
            <CheckBox IsChecked="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanConverter}}" IsEnabled="{Binding IsEditable}">
                <CheckBox.Content>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding CurrentCheckText}" />
                        <TextBlock Text=", " />
                        <TextBlock Foreground="#8E99F3" Text="{Binding AdditionalText}" />
                    </StackPanel>
                </CheckBox.Content>
                <CheckBox.ToolTip>
                    <Binding FallbackValue="해당 설정에 대한 설명이 없습니다." Path="ToolTip" />
                </CheckBox.ToolTip>
            </CheckBox>
        </DataTemplate>

        <!--  Text 템플릿  -->
        <DataTemplate x:Key="TextTemplate">
            <TextBox Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" ToolTip="{Binding ToolTip}" />
        </DataTemplate>

        <!--  ReadOnly 템플릿  -->
        <DataTemplate x:Key="ReadOnlyTemplate">
            <TextBlock
                Padding="5"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Center"
                Background="{DynamicResource MaterialDesignCardBackground}"
                Foreground="Gray"
                Text="{Binding Value}"
                ToolTip="{Binding ToolTip, FallbackValue='읽기 전용 값입니다.'}" />
        </DataTemplate>

        <!--  FilePath 템플릿  -->
        <DataTemplate x:Key="FilePathTemplate">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBox
                    Grid.Column="0"
                    Margin="0,0,2,0"
                    VerticalAlignment="Center"
                    IsReadOnly="{Binding IsEditable, Converter={StaticResource InverseBooleanConverter}}"
                    Text="{Binding Value}"
                    ToolTip="{Binding ToolTip, FallbackValue='파일 경로를 입력하거나 선택하세요.'}" />
                <Button
                    Grid.Column="1"
                    Margin="0,2,2,2"
                    Command="{Binding BrowseCommand}"
                    Content="..."
                    ToolTip="파일 탐색기를 열어 파일을 선택하세요." />
            </Grid>
        </DataTemplate>

        <!--  DirectoryPath 템플릿  -->
        <DataTemplate x:Key="DirectoryPathTemplate">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBox
                    Grid.Column="0"
                    Margin="0,0,2,0"
                    VerticalAlignment="Center"
                    IsReadOnly="{Binding IsEditable, Converter={StaticResource InverseBooleanConverter}}"
                    Text="{Binding Value}"
                    ToolTip="{Binding ToolTip, FallbackValue='디렉터리 경로를 입력하거나 선택하세요.'}" />
                <Button
                    Grid.Column="1"
                    Margin="0,2,2,2"
                    Command="{Binding BrowseCommand}"
                    Content="..."
                    ToolTip="파일 탐색기를 열어 디렉터리를 선택하세요." />
            </Grid>
        </DataTemplate>

        <!--  TitleBar 템플릿  -->


        <!--  ParameterTemplateSelector 정의  -->
        <local:ParameterTemplateSelector
            x:Key="ParameterTemplateSelector"
            CheckBoxTemplate="{StaticResource CheckBoxTemplate}"
            ComboBoxTemplate="{StaticResource ComboBoxTemplate}"
            DirectoryPathTemplate="{StaticResource DirectoryPathTemplate}"
            FilePathTemplate="{StaticResource FilePathTemplate}"
            NumberTemplate="{StaticResource NumberTemplate}"
            ReadOnlyTemplate="{StaticResource ReadOnlyTemplate}"
            TextTemplate="{StaticResource TextTemplate}" />
    </UserControl.Resources>

    <Grid>
        <Grid Margin="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="0.07*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="0.2*" />
            </Grid.ColumnDefinitions>

            <VSControls:VsDataGrid
                x:Name="VsParameterDataGrid"
                Grid.Row="0"
                Grid.ColumnSpan="2"
                AutoGenerateColumns="False"
                Background="White"
                CanUserAddRows="False"
                CanUserDeleteRows="False"
                CanUserSortColumns="False"
                ItemsSource="{Binding ParameterItems, RelativeSource={RelativeSource AncestorType=UserControl}}"
                RowHeaderWidth="0"
                ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                SelectionMode="Single">
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Style.Triggers>
                            <!--  IsVisible이 false인 경우 해당 행을 숨김  -->
                            <DataTrigger Binding="{Binding IsVisible}" Value="False">
                                <Setter Property="Visibility" Value="Collapsed" />
                            </DataTrigger>
                            <!--  TitleBar 스타일  -->
                            <DataTrigger Binding="{Binding Type}" Value="TitleBar">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="DataGridRow">
                                            <TextBlock
                                                Padding="5"
                                                HorizontalAlignment="Stretch"
                                                Background="#F3E5F5"
                                                FontSize="12"
                                                FontWeight="Bold"
                                                Foreground="#6A1B9A"
                                                Text="{Binding DisplayText}"
                                                TextAlignment="Center"
                                                ToolTip="{Binding ToolTip}" />
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>

                <VSControls:VsDataGrid.Columns>
                    <DataGridTextColumn
                        Width="*"
                        vsl:VsLocalization.LanguageType="{Binding Source={StaticResource LangProxy}, Path=CurrentLanguage}"
                        vsl:VsLocalization.LocalizationKey="Parameter"
                        Binding="{Binding DisplayText}"
                        Header="Parameter"
                        IsReadOnly="True" />
                    <DataGridTemplateColumn
                        Width="*"
                        vsl:VsLocalization.LanguageType="{Binding Source={StaticResource LangProxy}, Path=CurrentLanguage}"
                        vsl:VsLocalization.LocalizationKey="Value"
                        CellTemplateSelector="{StaticResource ParameterTemplateSelector}"
                        Header="Value"
                        IsReadOnly="True" />
                </VSControls:VsDataGrid.Columns>
            </VSControls:VsDataGrid>

            <Viewbox
                Grid.Row="1"
                Grid.Column="1"
                Margin="0,2"
                Stretch="Fill">
                <DockPanel>
                    <VSControls:VsButton
                        vsl:VsLocalization.LanguageType="{Binding Source={StaticResource LangProxy}, Path=CurrentLanguage}"
                        vsl:VsLocalization.LocalizationKey="Default"
                        Click="VsButton_DefaultClick" />
                    <VSControls:VsButton
                        Margin="5,0,0,0"
                        vsl:VsLocalization.LanguageType="{Binding Source={StaticResource LangProxy}, Path=CurrentLanguage}"
                        vsl:VsLocalization.LocalizationKey="Save"
                        Click="VsButton_SaveClick" />
                </DockPanel>
            </Viewbox>
        </Grid>
    </Grid>
</UserControl>
